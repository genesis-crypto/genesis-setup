name: Extract Content

on: 
  issues:
    types: [opened, reopened]

jobs:
  extract-content:
    runs-on: ubuntu-latest
    steps:
    - name: Extracting content
      run: |
        content=$(echo "${{ github.event.issue.body }}" | grep -E '(^### \[Repository\]$|^### \[Template\]$)')
        repository=$(echo "$content" | awk '/^### \[Repository\]$/{p=1;next}/^### \[Template\]$/{p=0}p' | tail -n +2 | head -n -1)
        template=$(echo "$content" | awk '/^### \[Template\]$/{p=1;next}p' | tail -n +2)
        echo "Repository: $repository"
        echo "Template: $template"
        echo "::set-output name=repository::$repository"
        echo "::set-output name=template::$template"

    - name: Save output to cache
      id: save-on-cache
      uses: actions/cache@v2
      with:
        path: outputs
        key: ${{ runner.os }}-extract-content-${{ hashFiles('outputs/repository outputs/template') }}
        restore-keys: |
          ${{ runner.os }}-extract-content-