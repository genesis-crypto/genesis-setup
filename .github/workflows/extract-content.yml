name: Extract Content

on: 
  issues:
    types: [opened, reopened]

jobs:
  extract-content:
    runs-on: ubuntu-latest
    steps:
    - name: Restore cache
      uses: actions/cache@v2
      with:
        path: output.json
        key: ${{ runner.os }}-pandoc-${{ hashFiles('**/output.json') }}
        restore-keys: |
          ${{ runner.os }}-pandoc-
          
    - name: Convert markdown to JSON
      run: |
        issue_body=$(echo "$GITHUB_EVENT_PATH" | jq -r .issue.body)
        pandoc -s -f markdown -t json <(echo "$issue_body") > output.json
      shell: bash
    
    - name: Save cache
      uses: actions/cache@v2
      with:
        path: output.json
        key: ${{ runner.os }}-pandoc-${{ hashFiles('**/output.json') }}
