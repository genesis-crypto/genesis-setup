name: Extract Content

on: 
  issues:
    types: [opened, reopened]

jobs:
  extract-content:
    runs-on: ubuntu-latest
    steps:
    - name: Install pandoc
      run: sudo apt-get install pandoc -y

    - name: Restore cache
      uses: actions/cache@v2
      with:
        path: output.json
        key: ${{ runner.os }}-pandoc-${{ hashFiles('**/output.json') }}
        restore-keys: |
          ${{ runner.os }}-pandoc-
          
    - name: Convert markdown to JSON
      run: |
        issue_body="${{ github.event.issue.body }}"
        pandoc -s -f markdown -t json <(echo "$issue_body") > output.json
      shell: bash

    - name: Output JSON content
      run: cat output.json

    - name: Save cache
      uses: actions/cache@v2
      with:
        path: output.json
        key: ${{ runner.os }}-pandoc-${{ hashFiles('**/output.json') }}
