name: Extract Content

on: 
  issues:
    types: [opened, reopened]

jobs:
  extract-content:
    runs-on: ubuntu-latest
    steps:
    - name: Extracting content
      run: |
        content=$(echo "${{ github.event.issue.body }}" | grep -E '(^### \[Repository\]$|^### \[Template\]$)')
        repository=$(echo "$content" | awk '
          BEGIN { RS = "^### \\[Repository\\]$"; ORS = "" }
          /^\s*\n/ { print $0; next }
          { print "\n" $0 }
        ')
        template=$(echo "$content" | awk '
          BEGIN { RS = "^### \\[Template\\]$"; ORS = "" }
          /^\s*\n/ { print $0; next }
          { print "\n" $0 }
        ')
        echo "Repository: $repository"
        echo "Template: $template"
        echo "::set-output name=repository::$repository"
        echo "::set-output name=template::$template"

    - name: Save output to cache
      id: save-on-cache
      uses: actions/cache@v2
      with:
        path: outputs
        key: ${{ runner.os }}-extract-content-${{ hashFiles('outputs/repository outputs/template') }}
        restore-keys: |
          ${{ runner.os }}-extract-content-